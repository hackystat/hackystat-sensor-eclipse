<project name="jar" default="jar">
  <description>
  Provides the target for building a jar file of the SensorBase.
  </description>

  <import file="build.xml"/>
 
  <target name="jar" depends="compile">   
    <mkdir dir="${build.dir}/org.hackystat.sensor.eclipse" />
    <copy todir="${build.dir}/org.hackystat.sensor.eclipse" failonerror="true" overwrite="false">
      <fileset dir="${build.result.folder}">
        <include name="sensor.eclipse.jar" />
      </fileset>
    </copy>
    <copy todir="${build.dir}/org.hackystat.sensor.eclipse" failonerror="true" overwrite="true">
      <fileset dir="${basedir}/plugin">
        <include name="META-INF/" />
        <include name="plugin.xml" />
        <include name="sensor.eclipse.jar" />
        <include name="lib/sensorshell.jar" />
        <include name="lib/activation.jar" />
        <include name="lib/jaxb-api.jar" />
        <include name="lib/jaxb-impl.jar" />
        <include name="lib/jsr173_1.0_api.jar" />
      </fileset>
    </copy>
    <antcall target="apitools.generation">
      <param name="target.folder" value="${destination.temp.folder}/org.hackystat.sensor.eclipse_8.0.1123" />
      <param name="projectLocation" value="${basedir}" />
      <param name="projectName" value="${bundleId}_${bundleVersion}" />
      <param name="binary.folders" value="${destination.temp.folder}/org.hackystat.sensor.eclipse_8.0.1123/sensor.eclipse.jar:${lib.dir}/jsr173_1.0_api.jar:${lib.dir}/sensorshell.jar:${lib.dir}jaxb-api.jar:${lib.dir}/jaxb-impl.jar:${lib.dir}/activation.jar" />
    </antcall>
    
  	<!-- Make a binary release on the top-level directory. -->
    <tstamp>
      <format property="YMDSTAMP" pattern="yyyyMMdd" />
    </tstamp>
    
    <jar destfile="${basedir}/org.hackystat.sensor.eclipse_${majorVersionNumber}.${minorVersionNumber}.v${YMDSTAMP}.jar"
      	 basedir="${build.dir}/org.hackystat.sensor.eclipse" filesetmanifest="merge">
    </jar>
  </target>
  
  <target name="apitools.generation" if="generateAPIDescription">
    <apitooling.apigeneration projectName="${projectName}" project="${projectLocation}" binary="${binary.folders}" target="${target.folder}" />
  </target>
</project>
