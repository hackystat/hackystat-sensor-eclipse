<project name="EclipseSensorHeadless" default="build" basedir=".">
  <!-- Headless build the Eclipse sensor -->
  
  <!-- Always make environment variables available with the "env." prefix. --> 
  <property environment="env"/> 
  
  <target name="build">
    <echo message="Base dir : ${basedir}"/>
    
    <!-- Cleans up the build directory if it exists. -->
    <delete dir="${basedir}/build" failonerror="false"/>
    
    <property name="featureDir" value="${basedir}/build/features/org.hackystat.sensor.eclipse"/>
    <property name="pluginDir"  value="${basedir}/build/plugins/org.hackystat.sensor.eclipse"/>
    
    <!-- Preparing feature -->
    <mkdir dir="${featureDir}"/>
    <copy todir="${featureDir}">
        <fileset dir="${basedir}/feature"/>
    </copy>
    
    <!-- Preparing plugin -->
    <mkdir dir="${pluginDir}"/>
    <copy todir="${pluginDir}">
        <fileset dir="${basedir}/plugin"/>
    </copy>
 
    <!-- 
         Build the feature and plugin in headless mode. Please be cautious that the version 
         numbers are from the Eclipse version you use. Be sure to change them if necessary. 
      -->
    <echo message="Launching the headless build."/>
    <java jar="${env.ECLIPSE_HOME}/plugins/org.eclipse.equinox.launcher_1.0.0.v20070606.jar" fork="true">
      <arg line="-application org.eclipse.ant.core.antRunner"/>
      <arg line="-buildfile ${env.ECLIPSE_HOME}/plugins/org.eclipse.pde.build_3.3.0.v20070612/scripts/build.xml"/>
      <jvmarg value="-DbaseLocation=${env.ECLIPSE_HOME}"/>
      <jvmarg value="-DbuildDirectory=${basedir}/build"/>
    </java>
    
    <unzip src="${basedir}/build/I.Build/org.hackystat.sensor.eclipse-Build.zip" dest="${basedir}/build/I.Build/"/>
    
    <mkdir dir="${basedir}/build/dist"/>
    <zip destfile="${basedir}/build/dist/hackystat-sensor-eclipse.zip">
        <fileset dir="${basedir}/build/I.Build/org.hackystat.sensor.eclipse"/>
    </zip>
 </target>
   

 <target name="clean">
    <!-- Cleans up the build directory if it exists. -->
    <delete dir="${basedir}/build" failonerror="false"/>
 </target>
</project>

